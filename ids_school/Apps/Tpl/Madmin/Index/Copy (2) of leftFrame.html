<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=Edge">
		<meta charset="UTF-8">
		<link rel="stylesheet" href="__PUBLIC__/style/reset.css">
		<!-- <link rel="stylesheet" href="__PUBLIC__/style/iconfont/iconfont.css"> -->
		<link rel="stylesheet" href="__PUBLIC__/flib/bt3/css/bootstrap.min.css">
		<link rel="stylesheet" href="__PUBLIC__/flib/fa3/css/font-awesome.min.css">
		<link rel="stylesheet" href="__PUBLIC__/style/madmin.css">
		<link rel="shortcut icon" href="__PUBLIC__/images/favicon.ico">
	</head>
	<body class="left-menu-body">
		<eq name="menuID" value="scences">
		<div class="menu-header" style="background:#34495E;width:200px;padding:6px;text-align:center;margin:10px auto;border-radius:16px;-moz-border-radius:16px;-webkit-border-radius:16px;">
			<a href="__GROUP__/Index/leftFrame/menuID/scences"><i class="icon-refresh"></i>&nbsp;&nbsp;更新内容</a>	
		</div>
		</eq>
		
		<div class="menu-box">
			<eq name="menuID" value="homepage">
			<ul class="menu-list" id="homepage">
			<else/>
			<ul class="menu-list" id="homepage" style="display:none;">
			</eq>
				<li>
					<a href="__URL__/rightFrame" target="frame_right_main" class="active"><i class=""></i> 欢迎页</a>
				</li>
				<li>
					<a href="javascript:void(0);"><span class="folded"></span><i class=""></i>  快捷操作</a>
					<ul data-folded="1">
						<li><a href="__GROUP__/Syscfg/modifyLoginPass" target="frame_right_main"><i class="icon-caret-right"></i> 设置登录密码</a></li>
						<php>	if (checkAccess('Endpoints', 'index')) {	</php>
						<li><a href="__GROUP__/Endpoints/index" target="frame_right_main"><i class="icon-caret-right"></i> 班牌列表</a></li>
						<php>	}	</php>
					</ul>
				</li>
			</ul>
			
			<eq name="menuID" value="scences">
			<ul class="menu-list" id="scences">
			<else/>
			<ul class="menu-list" id="scences" style="display:none">
			</eq>
				<volist name="scences" id="scence">
					<li id="scence-{$scence.id}">
						<notempty name="scence['sub_plugins']">
							<a href="javascript:void(0);" title="{$scence.scencename}"><span class="folded"></span><i class=""></i> <font>{$scence.short_scencename}</font><div class="item-tools"><i class="icon-edit" data-sid="{$scence.id}"></i></div></a>
							<ul data-folded="1">
								<volist name="scence['sub_plugins']" id="plugins">
									<li id="plugins-{$plugins.id}"><a href="__GROUP__/Plugins/index/pid/{$plugins.id}" target="frame_right_main"><i class="icon-caret-right"></i> <font>{$plugins.name}</font></a></li>
								</volist>
							</ul>
						<else/>
							<a href="__GROUP__/Scences/index/sid/{$scence.id}" target="frame_right_main" title="{$scence.scencename}"><span class="folded"></span><i class=""></i> <font>{$scence.short_scencename}</font><div class="item-tools"><i class="icon-edit" data-sid="{$scence.id}"></i></div></a>
						</notempty>
					</li>
				</volist>
			</ul>
			
			<eq name="menuID" value="syscfg">
			<ul class="menu-list" id="syscfg">
			<else/>
			<ul class="menu-list" id="syscfg" style="display:none">
			</eq>
				<php>	if (checkAccess('Syscfg', 'basicCfg')) {	</php>
				<li>
					<a href="__GROUP__/Syscfg/basicCfg" target="frame_right_main"><i class=""></i> 基本设置</a>
				</li>
				<php>	}	</php>
				<php>	if (checkAccess('Syscfg', 'advancedCfg')) {	</php>
				<li>
					<a href="__GROUP__/Syscfg/advancedCfg" target="frame_right_main"><i class=""></i> 高级设置</a>
				</li>
				<php>	}	</php>
				<php>	if (checkAccess('Syscfg', 'securityCfg')) {	</php>
				<li>
					<a href="__GROUP__/Syscfg/securityCfg" target="frame_right_main"><i class=""></i> 安全设置</a>
				</li>
				<php>	}	</php>
				<php>	if (checkAccess('Syscfg', 'nodesList') || checkAccess('Syscfg', 'addNode')) {	</php>
				<li>
					<a href="javascript:void(0);"><span class="folded"></span><i class=""></i>  模块管理</a>
					<ul data-folded="1">
						<php>	if (checkAccess('Syscfg', 'nodesList')) {	</php>
						<li><a href="__GROUP__/Syscfg/nodesList" target="frame_right_main"><i class="icon-caret-right"></i> 模块列表</a></li>
						<php>	}	</php>
						<php>	if (checkAccess('Syscfg', 'addNode')) {	</php>
						<li><a href="__GROUP__/Syscfg/addNode" target="frame_right_main"><i class="icon-caret-right"></i> 添加模块</a></li>
						<php>	}	</php>
					</ul>
				</li>
				<php>	}	</php>
			</ul>
			
			<eq name="menuID" value="endPoints">
			<ul class="menu-list" id="endPoints">
			<else/>
			<ul class="menu-list" id="endPoints" style="display:none">
			</eq>
				<php>	if (checkAccess('Endpoints', 'index')) {	</php>
				<li>
					<a href="__GROUP__/Endpoints/index" target="frame_right_main"><i class=""></i> 班牌列表</a>
				</li>
				<php>	}	</php>
				<php>	if (checkAccess('Ads', 'index')) {	</php>
				<li>
					<a href="__GROUP__/Ads/index" target="frame_right_main"><i class=""></i> 广告管理</a>
				</li>
				<php>	}	</php>
			</ul>
			
			<eq name="menuID" value="ucenter">
			<ul class="menu-list" id="ucenter">
			<else/>
			<ul class="menu-list" id="ucenter" style="display:none">
			</eq>
				<php>	if (checkAccess('Users', 'index') || checkAccess('Users', 'addUser')) {	</php>
				<li>
					<a href="javascript:void(0);"><span class="folded"></span><i class=""></i>  管理员</a>
					<ul data-folded="1">
						<php>	if (checkAccess('Users', 'index')) {	</php>
						<li><a href="__GROUP__/Users/index" target="frame_right_main"><i class="icon-caret-right"></i> 管理员列表</a></li>
						<php>	}	</php>
						<php>	if (checkAccess('Users', 'addUser')) {	</php>
						<li><a href="__GROUP__/Users/addUser" target="frame_right_main"><i class="icon-caret-right"></i> 添加管理员</a></li>
						<php>	}	</php>
					</ul>
				</li>
				<php>	}	</php>
				<php>	if (checkAccess('Users', 'rolesList') || checkAccess('Users', 'addRole')) {	</php>
				<li>
					<a href="javascript:void(0);"><span class="folded"></span><i class=""></i>  管理组</a>
					<ul data-folded="1">
						<php>	if (checkAccess('Users', 'rolesList')) {	</php>
						<li><a href="__GROUP__/Users/rolesList" target="frame_right_main"><i class="icon-caret-right"></i> 管理组列表</a></li>
						<php>	}	</php>
						<php>	if (checkAccess('Users', 'addRole')) {	</php>
						<li><a href="__GROUP__/Users/addRole" target="frame_right_main"><i class="icon-caret-right"></i> 创建管理组</a></li>
						<php>	}	</php>
					</ul>
				</li>
				<php>	}	</php>
			</ul>
		</div>
		
		<div class="left-bottom-box">
			<p class="text-center">{$Think.config.a_copyright}</p>
			<p class="text-center">{$Think.config.a_aftersales}</p>
		</div>
		
		<div class="my-cover" style="display:none;"></div>
		
		<script type="text/javascript" src="__PUBLIC__/script/jquery/jquery-1.11.0.min.js"></script>
		<script type="text/javascript" src="__PUBLIC__/script/common.js"></script>
		<script type="text/javascript">
		$(function($) {
			var menuID = "{$menuID|default=''}",
				menuDef = "{$menuDef|default=''}";
			setMenuDef(menuID, menuDef);
			
			$('.menu-box li').delegate('a', 'click', function() {
				if($.trim($(this).attr('href')) != 'javascript:void(0);') {
					pagePreLoader();
				}
			});
			
			// 导航级联展示效果
			//$('.menu-list > li > a').click(function() {
			$('.menu-box').delegate('.menu-list > li > a', 'click', function() {
				var subMenu = $(this).siblings('ul').first();
				
				if (subMenu.length > 0) {
					var isFolded = parseInt(subMenu.attr('data-folded'));
				}
				
				$.each($('.menu-list').children('li'), function(i, o){
					$(o).children('a').first().removeClass('hover').children('span').first().removeClass('un-folded').addClass('folded');
					$(o).children('ul').first().attr('data-folded', 1).slideUp('fast');
				});	
				
				if (subMenu.length > 0) {
					if (isFolded) {
						$(this).children('span').first().removeClass('folded').addClass('un-folded');
						subMenu.attr('data-folded', 0).slideDown('fast');
						$(this).addClass('hover');
					} else {
						$(this).children('span').first().removeClass('un-folded').addClass('folded');
						subMenu.attr('data-folded', 1).slideUp('fast');
						$(this).removeClass('hover');
					}	
				} else {
					$('.menu-list > li > a').removeClass('active');
					$(this).addClass('active');
				}
			});

			//$('#scences > li > a').mouseover(function(){
			$('.menu-box').delegate('#scences > li > a', 'mouseover', function(){
				$(this).children('.item-tools').first().show();
				$(this).children('span').first().hide();
			});
			$('.menu-box').delegate('#scences > li > a', 'mouseout', function(){
				$(this).children('.item-tools').first().hide();
				$(this).children('span').first().show();
			});

			//$('#scences > li a .icon-edit').click(function(event){
			$('.menu-box').delegate('#scences > li a .icon-edit', 'click', function(event){
				pagePreLoader();
			
				var scenceID = $(this).attr('data-sid')*1;
				if (scenceID) {
					window.parent.frame_right_main.location.href = '__GROUP__/Scences/index/sid/'+scenceID;
				}
				$.each($('.menu-list').children('li'), function(i, o){
					$(o).children('a').first().removeClass('hover').children('span').first().removeClass('un-folded').addClass('folded');
					$(o).children('ul').first().attr('data-folded', 1).slideUp('fast');
				});	
				$('.menu-list > li > a, .menu-list li li a').removeClass('active');
				$(this).parents('a').first().addClass('active');
				event.stopPropagation();
			});
			
			//$('.menu-list li li a').click(function(){
			$('.menu-box').delegate('.menu-list li li a', 'click', function(){
				$('.menu-list > li > a, .menu-list li li a').removeClass('active');
				$(this).parents('ul').first().siblings('a').first().addClass('active');
				$(this).addClass('active');
			});
		})
		
		function setMenuDef(menuID, menuDef) {
			var tl = 0;
			
			window.parent.frame_right_main.location.href = menuDef;
			
			$.each($('#' + menuID + ' > li > a', window.parent.frame_left_menu.document), function(i, o) {
				if ($(o).attr('href') == menuDef) {
					$(o).addClass('active');
					tl = 1;
				}
			});
			
			if (!tl) {
				$.each($('#' + menuID + ' ul li > a', window.parent.frame_left_menu.document), function(i, o) {
					if ($(o).attr('href') == menuDef) {
						$(o).addClass('active').parents('ul').first().show().siblings('a').first().addClass('active');
						tl = 0;
					}
				});
			}
			
			if (!tl) {
				$.each($('#' + menuID + ' .icon-edit', window.parent.frame_left_menu.document), function(i, o) {
					if ('__GROUP__/Scences/index/sid/' + $(o).attr('data-sid') == menuDef) {
						$(o).parents('a').first().addClass('active');
						tl = 0;
					}
				});
			}
		}
		</script>
	</body>
</html>