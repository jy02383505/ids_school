<include file="Public/header" />
<link rel="stylesheet" href="__PUBLIC__/script/uploadify/uploadify.css">
<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
<script src="__PUBLIC__/script/jquery/jquery.min.js"></script>
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="__PUBLIC__/bootstrap/bootstrap.min.js"></script>
<link rel="stylesheet" href="__PUBLIC__/bootstrap/datetimepicker/bootstrap-datetimepicker.min.css">
<script src="__PUBLIC__/bootstrap/datetimepicker/bootstrap-datetimepicker.min.js"></script>
<script src="__PUBLIC__/bootstrap/datetimepicker/bootstrap-datetimepicker.zh-CN.js"></script>

<style>
#storeVideoUp .btn-default, #storeVideoUp .btn-default:hover, #storeVideoUp .btn-default:active, #storeVideoUp .btn-default:visited{background-color:#fff;border-color:#ccc;padding:3px 10px 4px;font-size:14px;outline:0;}
</style>

<ol class="breadcrumb">
	<li><a href="{:U('School/kaochangList')}">考场管理</a></li>
    <li><a href="{:U('School/kaochangExamplanList')}">考试安排</a></li>
	<li class="active">
        <switch name="ACTION_NAME" >
        <case value="addKaochangExamplan" break="1">添加</case>
        <case value="editKaochangExamplan">修改</case>
        <default />添加
        </switch>
        考试安排
    </li>
</ol>
<form id="editForm" class="form-horizontal" role="form" method="post" action="__SELF__">

  	<div class="form-group " style="margin-bottom:0px;">
		<label class="col-sm-2 control-label" for="roomId">考场</label>
        <div class="col-sm-10 " >
			<style>
                #banji_list li{margin-right:10px;}
            </style>        
            <ul class="list-group" id="kaochang_list">
                <li type="button" class="btn btn-default btn-sm" data-toggle="modal" data-target="#kaochangModal" id="btn_sel_kaochan">选择考场</li>
                <span id="kaochang_list_v">
                    <volist name="kaochang_list" id="vo">
                    <li class="btn btn-warning btn-sm"  type="button" bid="{$vo.id}">{$vo.name}<span class="hide" ><i class="hide glyphicon glyphicon-remove pull-right btn-removefromlist" bid="{$vo.id}"></i></span></li>
                    </volist>
                </span>
            </ul>
        </div>
	</div> 

  	<div class="form-group " style="margin-bottom:0px;">
		<label class="col-sm-2 control-label" for="banjiId">考试科目</label>
        <div class="col-sm-10" >
			<style>
                #subject_list li{margin-right:10px;}
            </style>        
            <ul class="list-group" id="subject_list">
                <li type="button" class="btn btn-default btn-sm has-error" data-toggle="modal" data-target="#subjectModal" id="btn_sel_subject">选择科目</li>
                <span id="subject_list_v">
                    <volist name="subject_list" id="vo">
                    <li class="btn btn-warning btn-sm"  type="button" bid="{$vo.id}">{$vo.name}<span class="hide" ><i class="hide glyphicon glyphicon-remove pull-right btn-removefromlist" bid="{$vo.id}"></i></span></li>
                    </volist>
                </span>
            </ul>
        </div>
	</div>
    

	<div class="form-group" >
        <label class="col-sm-2 control-label">时间范围</label>
        <div class="col-sm-1">
            <input class="form-control " name="starttime" id="starttime" type="text" placeholder="开始时间" style="width:160px;" value="{$datas.starttime}">

        </div>
        <div class="col-sm-1" style="margin-left:40px;">
            <input class="form-control " name="endtime" id="endtime" type="text" placeholder="结束时间" style="width:160px;" value="{$datas.endtime}">
        </div>
		<div class="col-sm-1" style="margin-left:40px;">
			<li type="button" class="btn btn-default" data-toggle="modal" data-target="#examTimeModal">选择时间</li>
		</div>
	</div>
    
  	<div class="form-group " style="margin-bottom:0px;">
		<label class="col-sm-2 control-label" for="banjiId">监考教师</label>
        <div class="col-sm-10 " >
			<style>
                #teacher_list li{margin-right:10px;}
				#grade_list li{margin-right:10px;}
            </style>        
            <ul class="list-group" id="teacher_list">
                <li type="button" class="btn btn-default btn-sm" data-toggle="modal" data-target="#teacherModal" id="btn_sel_teacher">选择教师</li>
                <span id="teacher_list_v">
                    <volist name="teacher_list" id="vo">
                    <li class="btn btn-warning btn-sm"  type="button" bid="{$vo.id}">{$vo.name}<span class="hide" ><i class="hide glyphicon glyphicon-remove pull-right btn-removefromlist" bid="{$vo.id}"></i></span></li>
                    </volist>
                </span>
            </ul>
        </div>
	</div> 
    
	<div class="form-group">
		<label class="col-sm-2 control-label " for="name">参考人数</label>
		<div class="col-sm-1">
			<input class="form-control input-sm" type="text" name="population" id="population" value="{$datas.population}" placeholder='请输入数字'>
		</div>
        <div class="col-sm-2"><span class="help-block"></span></div>
	</div>

	<div class="form-group">
		<label class="col-sm-2 control-label" for="description">简介</label>
		<div class="col-sm-4">
			<textarea class="form-control" name="description" id="description" rows="4">{$datas.description}</textarea>
			<!-- <script id="aContent" name="aContent" type="text/plain" style="height:280px;">{$actiInfo.aContent}</script> -->
		</div>
	</div>

	<div class="form-group">
		<label class="col-sm-2 control-label" for="">&nbsp;</label>
		<div class="col-sm-4">
			<input type="hidden" name="id" value="{$datas.Id}">
			<button type="button" class="btn btn-info btn-sm kaochangSubmit">保存更改</button>&nbsp;&nbsp;
			<button type="reset" class="btn btn-default btn-sm">取消</button>
		</div>
	</div>
    
<!--zjh add start 模态对话框-->
<include file="Public/schoolKaochangModal" />
<include file="Public/schoolTeacherModal" />
<include file="Public/schoolSubjectModal" />
<include file="Public/schoolGradeModal" />
<include file="Public/schoolBanjiModal" />
<include file="Public/schoolExamTimeModal" />
<!--zjh add end 模态对话框-->
</form>




<include file="Public/jsLoader" />
<script type="text/javascript" src="__PUBLIC__/script/uploadify/jquery.uploadify.js"></script>
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/ueditor/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/ueditor/ueditor.all.js"> </script>
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/ueditor/lang/zh-cn/zh-cn.js"></script>

<script type="text/javascript" src="__PUBLIC__/script/jquery/jquery.validate.min.js"></script>
<script type="text/javascript">
$(function($) {
	$('button[type="reset"]').click(function(){
		window.location.href = '__URL__/kaochangExamplanList';
	});

    // 添加考场、考试科目、监考教师验证条件，不填写无法提交表单
    $('button.kaochangSubmit').click(function(){
        if($('#kaochang_list_v li').length && $('#subject_list_v li').length && $('#teacher_list_v li').length){
            $('#editForm').submit();
        }else{
            $.kw.alert('考场、考试科目、教考教师为必填项');
            return false;
        }
    })
	
	$('#editForm').validate({
		errorElement : 'span',
		errorClass : 'help-block',
		focusInvalid : true,  
        rules : {  
        	starttime : {  
				required : true,
            },
        	endtime : {  
				required : true,
            },
			// population : {
			// 	required : true,
			// 	number : true,
			// },
			// description : {
			// 	required : true,
			// },
        },  
        messages : {
        	starttime : {  
                required : "开始时间必填.",
            },
        	endtime : {  
                required : "结束时间必填.",
            },
    //     	population : {  
				// required : "参考人数必填.",
    //             number : "必须为数字.",
    //         },
        	// description : {  
         //        required : "内容必填.",
         //    },
        },

        highlight : function(element) {  
            $(element).closest('.form-group').addClass('has-error');  
        },  

        success : function(label) {  
            label.closest('.form-group').removeClass('has-error');  
            label.remove();  
        },  

        errorPlacement : function(error, element) {  
            element.parent('div').append(error);  
        },  
		submitHandler: function(form) {
		
			var kaochang_len = $("input[name='kaochangIdStr[]']:checked").length;
			if (!kaochang_len){
				$("#btn_sel_kaochan").css({"border-color":"rgb(169, 68, 66)"});
				alert("请选择考场");	
				return;
			}
			
			var subject_len = $("input[name='subjectIdStr[]']:checked").length;
			if (!subject_len){
				$("#btn_sel_subject").css({"border-color":"rgb(169, 68, 66)"});
				alert("请选择科目");	
				return;
			}
			
			var teacher_len = $("input[name='teacherIdStr[]']:checked").length;
			if (!teacher_len){
				$("#btn_sel_teacher").css({"border-color":"rgb(169, 68, 66)"});
				alert("请选择教师");	
				return;
			}
			form.submit();
		}
	});
});
</script>

<script>
$(document).ready(function() {
	//科目选择选择 START
	/*$(".btn-removefromlist").click(function(){
		//alert($(this).parent().attr("bid"));
		var bid = $(this).parent().attr("bid");
		var a = "#chk_grade_" + bid;
		//alert(a);
		//$("input[@name =S_03_22]").parent().prev().text();
		//$("#chkddd").prop("checked", true);//这样是操作一般复选框
		//$(a).iCheck('check');//这是操作icheck复选框的
		$(a).iCheck('uncheck');//这是操作icheck复选框
		//alert($("#chkddd").prop("checked"));//返回true
		//$("#chk8").remove();
		$(this).parent().remove();
	});*/

	$('.chk_subject').on('ifChecked', function(event){
		var val = $(this).val();
		var tName = $(this).attr("tName");
	//	alert(val);
		//检测list，然后加入新的
		$("#subject_list li").each(function(){
			//alert($(this).attr("bid"));
			//
			var tmp_bid = $(this).attr("bid");
			if (tmp_bid == val){
				//alert('list中已有此记录;bid='+tmp_bid);
				return;
			}			
		});
		$('#subject_list_v').append('<li class="btn btn-warning btn-sm" bid="' + val + '">' + tName + '<i class="hide glyphicon glyphicon-remove pull-right btn-removefromlist"></i></li>');
		$("#btn_sel_subject").css({"border-color":""});
	});
	
	//从list中删除一条
	$('.chk_subject').on('ifUnchecked', function(event){
		var val = $(this).val();
		var tName = $(this).attr("tName");
		//alert(val);
		//检测list，然后加入新的
		$("#subject_list li").each(function(){
			//alert($(this).attr("bid"));
			//
			var tmp_bid = $(this).attr("bid");
			if (tmp_bid == val){
				//alert('list中已有此记录');
				$(this).remove();
			}			
		});
	});
	//科目选择 END
	
});
</script>

<script>
function checkAndUncheckTeacher(){
    //教师选择选择 START
    $('.chk_teacher').on('ifChecked', function(event){
        var val = $(this).val();
        var tName = $(this).attr("tName");
        var had = 0;
        //检测list，然后加入新的
        $("#teacher_list li").each(function(){
            //alert($(this).attr("bid"));
            var tmp_bid = $(this).attr("bid");
            if (tmp_bid == val){
                had = 1;
                return;
            }       
        });
        
        //当不存在时添加到显示区
        if (had == 0){
            $('#teacher_list_v').append('<li class="btn btn-warning btn-sm" bid="' + val + '">' + tName + '<i class="hide glyphicon glyphicon-remove pull-right btn-removefromlist"></i></li>');
        }
        $("#btn_sel_teacher").css({"border-color":""});
    });
    
    //从list中删除一条
    $('.chk_teacher').on('ifUnchecked', function(event){
        var val = $(this).val();
        var tName = $(this).attr("tName");
        //检测list，然后加入新的
        $("#teacher_list li").each(function(){
            //alert($(this).attr("bid"));
            var tmp_bid = $(this).attr("bid");
            if (tmp_bid == val){
                //alert('list中已有此记录');
                $(this).remove();
            }           
        });
    });
    //教师选择 END
}

checkAndUncheckTeacher();
	
</script>

<script>
$(document).ready(function() {
	//考场选择选择 START
	$('.chk_kaochang').on('ifChecked', function(event){
		var val = $(this).val();
		var tName = $(this).attr("tName");
	//	alert(val);
		//检测list，然后加入新的
		$("#kaochang_list li").each(function(){
			//alert($(this).attr("bid"));
			//
			var tmp_bid = $(this).attr("bid");
			if (tmp_bid == val){
				//alert('list中已有此记录');
				return;
			}			
		});
		$('#kaochang_list_v').append('<li class="btn btn-warning btn-sm" bid="' + val + '">' + tName + '<i class="hide glyphicon glyphicon-remove pull-right btn-removefromlist"></i></li>');
		$("#btn_sel_kaochan").css({"border-color":""});
	});
	
	//从list中删除一条
	$('.chk_kaochang').on('ifUnchecked', function(event){
		var val = $(this).val();
		var tName = $(this).attr("tName");
		//alert(val);
		//检测list，然后加入新的
		$("#kaochang_list li").each(function(){
			//alert($(this).attr("bid"));
			//
			var tmp_bid = $(this).attr("bid");
			if (tmp_bid == val){
				//alert('list中已有此记录');
				$(this).remove();
			}			
		});
	});
	//考场选择 END
	
});
</script>

<script>
$(document).ready(function() {
	//考试时间:对话框的单选按钮被选中
	$('.this_examtime').on('ifChecked', function(event){
		var val = $(this).val();
		//从对话框取开始时间和结束时间
		var st = $(this).attr("attr-starttime");
		var et = $(this).attr("attr-endtime");
		//设置开始时间和结束时间
		$("#starttime").val(st);
		$("#endtime").val(et);
	});		
		
});
</script>

<include file="Public/footer" />